# Pocket to Notion Importer

このStreamlitアプリケーションは、PocketからエクスポートしたCSVファイルを読み込み、その内容をNotionデータベースにインポートします。
ウェブページのタイトルや本文をスクレイピングして取得し、Notionのページとして登録することができます。

## ✨ 機能

*   **CSVアップロード**: PocketからエクスポートしたCSVファイルをアップロードします。
*   **Notion認証**: Notion APIキーとデータベースIDを使用してNotionに接続します。
*   **プロパティマッピング**: CSVのカラム（`title`, `url`, `time_added`, `tags`, `status`）をNotionデータベースのプロパティに柔軟にマッピングできます。
*   **ウェブスクレイピング**:
    *   CSVの`url`列にあるURLから、Playwrightを使用してウェブページのタイトルと本文（オプション）を取得します。
    *   HTTPステータスが404のページはスキップします。
*   **本文処理**:
    *   取得した本文は、Notion APIの制限（1ブロックあたり2000文字）に合わせて、安全マージンを取った上で（デフォルト1900文字）複数の段落ブロックに分割して登録します。
    *   本文の登録はオプションでON/OFF可能です。
*   **進捗表示**: CSVの処理状況をプログレスバーとテキストで表示します。
*   **結果表示**: 処理完了後、成功・失敗・スキップしたアイテム数を表示します。
*   **使い方ガイド**: アプリケーション内に詳細な使い方ガイドを表示します。

## 🛠️ 必要なもの

*   Python 3.8以上
*   Pocketアカウント（CSVエクスポートのため）
*   Notionアカウント
    *   Notionインテグレーションの作成とAPIキーの取得
    *   インポート先のNotionデータベースとデータベースID

## 🚀 セットアップ

1.  **リポジトリをクローンまたはダウンロードします。**
2.  **必要なライブラリをインストールします。**
    ```bash
    pip install streamlit pandas playwright notion-client beautifulsoup4
    ```
3.  **Playwright用のブラウザをインストールします。**
    （初回実行時、または以下のコマンドで事前にインストール）
    ```bash
    playwright install
    ```
    または、特定のブラウザのみインストールする場合（このアプリではChromiumを使用）:
    ```bash
    playwright install chromium
    ```

## 🏃‍♀️ 使い方

1.  **Streamlitアプリケーションを実行します。**
    ターミナルで以下のコマンドを入力します。
    ```bash
    streamlit run your_script_name.py
    ```
    （`your_script_name.py` はこのPythonスクリプトのファイル名に置き換えてください）

2.  **ブラウザでアプリケーションが開きます。**

3.  **サイドバーでNotion認証情報を設定します。**
    *   **Notion API キー**: あなたのNotionインテグレーションのトークンを入力します。
    *   **Notion データベース ID**: インポート先のNotionデータベースのIDを入力します。
    *   **本文を Notion に登録する**: チェックボックスで、スクレイピングした本文をNotionページに登録するかどうかを選択します（デフォルトはON）。
    *   正しく設定されると、「データベース情報を取得しました。」と表示されます。
    *   詳細な手順は「使い方を見る」ボタンで確認できます。

4.  **STEP1: CSVカラムとNotionプロパティの紐づけ設定**
    *   メインエリアに表示されるドロップダウンメニューで、PocketのCSVカラム（`title`, `url`, `time_added`, `tags`, `status`）と、Notionデータベースの対応するプロパティを選択します。
    *   **注意点:**
        *   `time_added` はNotionの「作成日時 (Created Time)」プロパティには直接マッピングできません。事前にNotion側で「日付 (Date)」型のカスタムプロパティ（例: `Added Date`）を作成し、それにマッピングしてください。
        *   `tags` はNotionの「マルチセレクト (Multi-select)」型プロパティにマッピングすることを想定しています。
        *   `status` はNotionの「セレクト (Select)」型プロパティにマッピングすることを想定しています。

5.  **STEP2: CSVファイルを選択してNotionに登録**
    *   「Pocket からエクスポートした CSV を選択」ボタンをクリックし、[Pocket公式サイト](https://getpocket.com/export)からエクスポートしたCSVファイルを選択します。
    *   ファイルがアップロードされると、CSVのプレビューと行数が表示されます。
    *   「CSV を Notion に登録」ボタンをクリックすると、インポート処理が開始されます。
        *   処理中はプログレスバーと現在の処理行数が表示されます。
        *   ターミナル（Streamlitを実行しているコンソール）には、より詳細なスクレイピングや処理のログが出力されます。
    *   処理が完了すると、成功・失敗・スキップされたアイテム数が表示されます。

## ⚙️ 主要な設定値（コード内）

*   `split_text_to_paragraph_blocks` 関数内の `max_chunk_len_api`:
    Notionの段落ブロックごとの最大文字数。API制限は2000文字ですが、安全マージンとUnicode文字の解釈差異を考慮して `1900` に設定されています。必要に応じて調整可能ですが、APIエラーを避けるため2000より小さい値を推奨します。

## 📜 ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 🤝 貢献

バグ報告や機能提案は、GitHubのIssueを通じて歓迎します。
